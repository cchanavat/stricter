\section{Diagrammatic sets}

\subsection{Diagrams in a diagrammatic set}

Recall that a diagrammatic set is a presheaf over the category \( \atom \).
We write \( \dgmSet \) for the category of diagrammatic sets.
By \cite[Lemma 2.5]{chanavat2024htpy}, the Yoneda embedding \( \atom \incl \dgmSet \) factors as
\begin{equation*}
    \atom \incl \rdcpxcart \incl \dgmSet,
\end{equation*} 
and in the sequel, we always identify a regular directed complex with its associated diagrammatic set.

\begin{dfn} [Diagram in a diagrammatic set]
    Let \( U \) be a regular directed complex and \( X \) a diagrammatic set.
    A \emph{diagram of shape \( U \) in \( X \)} is a morphism \( u \colon U \to X \).
    A diagram is called
    \begin{itemize}
        \item a \emph{pasting diagram} if \( U \) is a molecule,
        \item a \emph{round diagram} if \( U \) is a \emph{round} molecule, and
        \item a \emph{cell} if \( U \) is an atom.
    \end{itemize}
    We let \( \dim u \eqdef \dim U \), and call respectively \( \Pd X \), \( \Rd X \) and \( \cell X \) the sets of pasting diagrams, round diagrams, and cells in \( X \).
\end{dfn}

\begin{rmk}
    By the Yoneda Lemma, we identify a cell \( u \colon U \to X \) with its corresponding element \( u \in X(U) \).
    Furthermore, since isomorphisms of molecules are unique when they exists, we may safely identify isomorphic pasting diagrams in the slice over \( X \).
\end{rmk}

\begin{dfn} [Subdiagram]
    Let \( u \colon U \to X \) be a pasting diagram in a diagrammatic set \( X \).
    A \emph{subdiagram of \( u \)} is a pair of a pasting diagram \( v \colon V \to X \) and a submolecule inclusion \( \iota \colon V \incl U \) such that \( u \after \iota = v \).
    A subdiagram is \emph{rewritable} if the submolecule inclusion \( \iota \) is rewritable.
    We write \( \iota \colon v \submol u \) for the data of a subdiagram of \( u \), or simply \( v \submol u \) if \( \iota \) is irrelevant or evident from the context. 
\end{dfn}

\begin{dfn} [Composition structure of pasting diagrams]
    Let \( u \colon U \to X \) be a pasting diagram in a diagrammatic set \( X \).
    For \( n \geq 0 \) and \( \a \in \set{-, +} \), we write \( \bd{n}{\a} u \) for the pasting diagram \( \restr{u}{\bd{n}{\a}U} \colon \bd{n}{\a} U \to X \).
    We may omit the index \( n \) if \( n = \dim u - 1 \).
    This makes \( \Pd(X) \) a reflexive \( \omega \)\nbd graph.
    Now let \( u \colon U \to X \) and \( v \colon V \to X \) be pasting diagrams, such that \( \bd{k}{+} u = \bd{k}{-} v \).
    We let \( u \cp{k} v \colon U \cp{k} V \to X \) be the unique pasting diagram determined by the universal property of the pushout \( U \cp{k} V \).
    This makes \( \Pd(X) \) a composition structure.
\end{dfn}
\noindent We often omit the index \( k \) when it is equal to \( \min \set{\dim u, \dim v} - 1 \), and omit \( \iota \) when it is irrelevant or evident from the context.

\begin{rmk}
    \( \Rd(X) \) is a sub-reflexive graph \( \omega \)\nbd graph of \( \Pd(X) \), but is not itself a composition structure, since pastings of round diagrams are generally not round. 
\end{rmk}

\begin{lem} \label{lem:Pd_is_stricter}
    Let \( X \) be a diagrammatic set.
    Then the composition structure \( \Pd(X) \) is a stricter \( \omega \)\nbd category.
\end{lem}
\begin{proof}
    Let \( P \) be a regular directed complex and consider a matching family \( \set{\F_x \colon \molecin{\imel{P}{x}} \to \Pd(X)}_{x \in P} \).
    Then the candidate amalgamation sends \( w \colon W \to P \) to the canonical \( \colim_{x \in W} \imel{P}{w(x)} \to X \), which does not depend on the decomposition of \( w \).
\end{proof}

\noindent Since morphisms \( f \colon X \to Y \) of diagrammatic sets also induce strict functors \( \Pd(f) \colon \Pd(X) \to \Pd(Y) \), this defines a functor
\begin{equation*}
    \Pd \colon \dgmSet \to \somegaCat.
\end{equation*}

\begin{dfn} [Bipointed diagrammatic set]
    A \emph{bipointed diagrammatic set} is given by a diagrammatic set \( X \) together with a pair of \( 0 \)\nbd cells \( a, b \colon \pt \to X \).
    We let \( \bpt\dgmSet \) be the category of bipointed diagrammatic sets and morphisms that respect the bipointing.
\end{dfn}

\begin{dfn} [Suspension]
    The \emph{suspension of diagrammatic sets} is the functor
    \begin{equation*}
        \sus{-} \colon \dgmSet \to \bpt{\dgmSet}
    \end{equation*} 
    defined as the left Kan extension along the Yoneda embedding of the functor sending an atom \( U \) to \( (\sus{U}, \bot^-, \bot^+) \).
\end{dfn}

\begin{prop} \label{prop:suspension_of_dgmSet}
    The functor \( \sus{} \colon \dgmSet \to \dgmSet \) preserves connected colimits.    
\end{prop}
\begin{proof}
    The category \( \bpt{\dgmSet} \) is the coslice \( \slice{(\pt + \pt)}{\dgmSet} \).
    Since \( \sus{-} \) is left adjoin by construction, the result follows from \cite[Proposition 3.3.8]{riehl2019context}
\end{proof}

\begin{dfn} [Connected diagrammatic set]
    Let \( X \) be a diagrammatic set. 
    We say that \( X \) is \emph{connected} if its category of elements is connected.
\end{dfn}

\begin{rmk} \label{rmk:ez_connected}
    Since \( \atom \) is an Eilenberg-Zilber category, \( X \) is connected if and only if its poset of non-degenerate cells is connected.
    In particular by \cite[Lemma 3.3.13]{hadzihasanovic2024combinatorics}, all molecules are connected.
\end{rmk}

\subsection{Degenerate diagrams and equivalences}

\begin{dfn} [Degenerate pasting diagram]
    Let \( u \colon U \to X \) be a diagram.
    We say that \( u \) is \emph{degenerate} if there exists a pair of a diagram \( v \colon V \to X \) and a surjective cartesian map of regular directed complexes \( p \colon U \to V \) such that \( v \after p = u \), and \( \dim v < \dim v \). 
    We let
    \begin{align*}
        \Dgn X &\eqdef \set{u \in \Pd X \mid u \text{ is degenerate}} & \dgn X \eqdef \Dgn X \cap \cell x,\\
        \Nd X & \eqdef \set{u \in \Pd X \mid u \text{ is not degenerate}} & \nd X \eqdef \Nd X \cap \cell x.
    \end{align*}
\end{dfn}

\begin{dfn} [Reverse of a degenerate diagram]
    Let \( u \colon U \to X \) be a degenerate diagram, equal to \( v \after p \) for some diagram \( v \colon V \to X \) and surjective cartesian map \( p \colon U \to V \) with \( n \eqdef \dim u > \dim v \).
    The \emph{reverse of \( u \)} is the diagram \( \rev{u} \eqdef v \after \dual{n}{p} \colon \dual{n}{U} \to X \).
\end{dfn}

\begin{dfn}[Partial cylinder]
    Given a graded poset \( P \) and a closed subset \( K \subseteq P \), the \emph{partial cylinder on \( P \) relative to \( K \)} is the graded poset \( \arr \times_K P \) obtained as the pushout
    \begin{center}
        \begin{tikzcd}
            {I \times K} & K \\
            {I \times P} & {I \times_K  P}
            \arrow[two heads, from=1-1, to=1-2]
            \arrow[hook', from=1-1, to=2-1]
            \arrow["{(-)}", hook', from=1-2, to=2-2]
            \arrow["q", two heads, from=2-1, to=2-2]
            \arrow["\lrcorner"{anchor=center, pos=0.125, rotate=180}, draw=none, from=2-2, to=1-1]
        \end{tikzcd}  
    \end{center}
    in the category of posets.
    This is equipped with a canonical projection map \( \tau_K \colon \arr \times_K P \surj P \).
\end{dfn}

\begin{dfn}[Partial Gray cylinder]
	Let \( U \) be a regular directed complex and \( K \subseteq U \) a closed subset.
	The \emph{partial Gray cylinder on \( U \) relative to \( K \)} is the oriented graded poset \( \arr \gray_K U \) whose
    \begin{itemize}
        \item underlying graded poset is \( \arr \times_K U \), and
        \item orientation is specified, for all \( \a \in \set{+, -} \), by
        \begin{align*}
            \faces{}{\a}(x) & \eqdef \set{(y) \mid y \in \faces{}{\a}x}, \\
            \faces{}{\a}(i, x) & \eqdef \begin{cases}
                \set{(0^\a, x)} + \set{(1, y) \mid y \in \faces{}{-\a}x \setminus K} &
                \text{if \( i = 1 \),} \\
                \set{(i, y) \mid y \in \faces{}{\a}x \setminus K} + 
                \set{(y) \mid y \in \faces{}{\a}x \cap K} &
                \text{otherwise}.
            \end{cases}
        \end{align*}
    \end{itemize}
\end{dfn}

\begin{dfn}[Inverted partial Gray cylinder]
	Let \( U \) be a molecule, \( n \eqdef \dim U \), and \( K \subseteq \bd{}{+}U \) a closed subset.
	The \emph{left-inverted partial Gray cylinder on \( U \) relative to \( K \)} is the oriented graded poset \( \lcyl{K} U \) whose
    \begin{itemize}
        \item underlying graded poset is \( \arr \times_K U \), and
        \item orientation is as in \( \arr \gray_K U \), except for all \( x \in \gr{n}{U} \) and \( \a \in \set{+, -} \)
    \begin{align*}
        \faces{}{-}(1, x) &\eqdef \set{(0^-, x), (0^+, x)} + \set{(1, y) \mid y \in \faces{}{+}x \setminus K}, \\
        \faces{}{+}(1, x) &\eqdef \set{(1, y) \mid y \in \faces{}{-}x}, \\
        \faces{}{\a}(0^+, x) &\eqdef \set{(0^+, y) \mid y \in \faces{}{-\a}x \setminus K} + 
            \set{(y) \mid y \in \faces{}{-\a}x \cap K}.
    \end{align*}
\end{itemize}
	Dually, if \( K \subseteq \bd{}{-}U \), the \emph{right-inverted partial Gray cylinder on \( U \) relative to \( K \)} is the oriented graded poset \( \rcyl{K}{U} \) whose
    \begin{itemize}
        \item underlying graded poset is \( \arr \times_K U \), and
        \item orientation is as in \( \arr \gray_K U \), except for all \( x \in \gr{n}{U} \) and \( \a \in \set{+, -} \)
        \begin{align*}
            \faces{}{-}(1, x) &\eqdef \set{(1, y) \mid y \in \faces{}{+}x}, \\
            \faces{}{+}(1, x) &\eqdef \set{(0^-, x), (0^+, x)} + \set{(1, y) \mid y \in \faces{}{-}x \setminus K}, \\
            \faces{}{\a}(0^-, x) &\eqdef \set{(0^-, y) \mid y \in \faces{}{-\a}x \setminus K} + 
                \set{(y) \mid y \in \faces{}{-\a}x \cap K}.
        \end{align*}
    \end{itemize}
\end{dfn}

\begin{rmk} \label{rmk:inverted_cylinder_well_def}
	By \cite[Lemma 1.20, Lemma 1.26]{chanavat2024equivalences}, partial Gray cylinders and inverted partial Gray cylinders respect the classes of molecules, round molecules and atoms.
	Moreover, for all molecules \( U \) and closed subset \( K \subseteq U \),
	\begin{itemize}
		\item \( \tau_K \colon \arr \gray_K U \to U \) is a cartesian map of molecules,
		\item if \( p \colon U \to V \) is a cartesian map of molecules with \( \dim V < \dim U \), then \( p \after \tau_K \colon \lcyl{K}{U} \to V \) and \( p \after \tau_K \colon \rcyl{K}{U} \to V \) are cartesian maps of molecules.
	\end{itemize}
\end{rmk}

\begin{dfn} [Higher invertor shapes] \label{dfn:higher_invertor_shape}
    Let \( U \) be a round molecule.
    The family of \emph{higher invertor shapes on \( U \)} is the family of molecules \( \hcyl \s U \) indexed by strings \( \s \in \set{L, R}^* \), defined inductively on the length of \( \s \) by
    \begin{align*}
        \hcyl{\langle\rangle} U & \eqdef U, \\
        \hcyl{L\s} U &\eqdef \lcyl{\bd{}{+} \hcyl{\s} U} (\hcyl{\s} U), \\
        \hcyl{R\s} U &\eqdef \dual{\dim U + |\s|}{\left(\rcyl{\bd{}{-} \hcyl{\s} U} (\hcyl{\s} U)\right)}.
    \end{align*}
	These are equipped with cartesian maps \( \tau_s \colon \hcyl{\s} U \to U \) of their underlying posets, with the property that for all cartesian maps of molecules \( p \colon U \to V \) such that \( \dim V < \dim U \), the composite \( p \after \tau_{\s} \) is a cartesian map of molecules.
\end{dfn}

\begin{lem} \label{lem:subdivision_of_unitors}
    Let \( s \colon U \sd V \) be a subdivision of molecules with formal dual \( c \colon V \to U \), and \( K \subseteq U \) be a subset of \( U \).
    Then the formal dual \( \arr \gray_K s \colon \arr \gray_K U \sd \arr \gray_{s(K)} V \) of the map \( \arr \times_K c \colon \arr \times_{s(K)} V \to \arr \times_K U \) is a subdivision of partial Gray cylinders.
\end{lem}
\begin{proof}
    Let \( x \in \arr \gray_K U \).
    Let \( V_x \eqdef s(\imel{U}{x}) \), \( K_x \eqdef \imel{U}{x} \cap K \), and \( c_x \) the restriction of \( c \) to \( V_x \)
    Then \( (\arr \gray_K s)\imel{U}{x} \) is isomorphic to \( \arr \gray_{s(K_x)} V_x \), which is a molecule.
    Now let \( q_V \colon \arr \times V_x \surj \arr \times_{s(K_x)} V_x  \) and \( q_U \colon \arr \times \imel{U}{x} \surj \arr \times_{K_x} \imel{U}{x} \) be the quotient maps.
    Then we have a commutative diagram
    \begin{center}
        \begin{tikzcd}
            {\arr \times V_x} & {\arr \times_{s(K_x)} V_x} \\
            {\arr \times \imel{U}{x}} & {\arr \times_{K_x} \imel{U}{x}.}
            \arrow["{q_V}", two heads, from=1-1, to=1-2]
            \arrow["{\arr \times c_x}"', from=1-1, to=2-1]
            \arrow["{\arr \times_{K_x} c_x}", from=1-2, to=2-2]
            \arrow["{q_U}"', two heads, from=2-1, to=2-2]
        \end{tikzcd}
    \end{center}
    By \cite[Proposition 7.2.21]{hadzihasanovic2024combinatorics}, the formal dual of \( \arr \times c_x \) is a subdivision.
    By inspection, for all \( k \in \mathbb{N} \) and \( \a \in \set{-, +} \), we have
    \begin{equation*}
        q_V(\bd{k}{\a} (\arr \gray V_x)) = \bd{k}{\a} (\arr \gray_{s(K_x)} V_x) \text{ and } q_U(\bd{k}{\a} (\arr \gray \imel{U}{x})) = \bd{k}{\a} (\arr \gray_{K_x} \imel{U}{x}),
    \end{equation*}
    which is enough to conclude. 
\end{proof}

\begin{lem} \label{lem:subdivision_of_invertors}
    Let \( s \colon U \sd V \) be a subdivision of atoms with formal dual \( c \colon V \to U \).
    Then
    \begin{enumerate}
        \item for all closed subsets \( K \subseteq \bd{}{+} U \), the formal dual \( \lcyl{K} s \colon \lcyl{K} U \sd \lcyl{s(K)} V \) of the map \( \arr \times_K c \colon \arr \times_{s(K)} V \to \arr \times_K U \) is a subdivision of left-inverted partial Gray cylinders, and dually
        \item for all closed subsets \( K \subseteq \bd{}{-} U \), the formal dual \( \rcyl{K} s \colon \rcyl{K} U \sd \rcyl{s(K)} V \) of the map \( \arr \times_K c \colon \arr \times_{s(K)} V \to \arr \times_K U \)  is a subdivision of right-inverted partial Gray cylinders.
    \end{enumerate}
\end{lem}
\begin{proof}
    We prove the first point, the second is entirely dual.
    Let \( n \eqdef \dim U \).
    By construction, \( \bd{}{-} \lcyl{K} U \) and \( \bd{}{+} \lcyl{K} U \) are, respectively, of the form
    \begin{equation*}
        U \cpsub{} (\arr \gray_K \bd{}{+} U) \subcp{} \dual{n}{U} \text{ and } \arr \gray_{K \cap \bd{}{-} U} \bd{}{-} U,
    \end{equation*}
    and similarly for \( \bd{}{-} \lcyl{K} V \) and \( \bd{}{+} \lcyl{K} V \).
    Since \( s(-) \) preserves pastings at submolecules and boundaries, we have by Lemma \ref{lem:subdivision_of_unitors} a clear subdivision of regular directed complexes 
    \begin{equation*}
        \restr{\lcyl{K} s}{\bd{}{} \lcyl{K} U} \colon \bd{}{} \lcyl{K} U \to \bd{}{} \lcyl{s(K)} V.
    \end{equation*}
    Since \( U \) and \( V \) are atoms, this extends to a subdivision \( \lcyl{K} s \colon \lcyl{K} U \to \lcyl{s(K)} V \)
\end{proof}

\begin{rmk}
    Given a subdivision \( s \colon U \sd V \) of atoms, and a string \( \s \in \set{L, R}^* \), we have by induction a subdivision \( \hcyl{\s} s \colon \hcyl{\s} U \sd \hcyl{\s} V \).
\end{rmk}

\begin{dfn} [Unit]
    Let \( u \colon U \to X \) be a pasting diagram.
    The \emph{unit on \( u \)} is the degenerate pasting diagram \( \un u \colon u \celto u \) defined by \( u \after \tau_{\bd{}{} U} \colon \arr \gray_{\bd{}{}U} U \to X \).
\end{dfn}

\begin{dfn} [Equivalence] 
    Let \( e \colon u \celto v \) be a round diagram in a diagrammatic set \( X \).
    We say that \( e \) is an \emph{equivalence} if there exist a round diagram \( e^* \colon v \celto u \), together with round diagrams \( h \colon e \cp{} e* \celto \un(u) \) and \( h' \colon e^* \cp{} e \celto \un(v) \) such that \( h \) and \( h' \) are equivalences.
    We let
    \begin{equation*}
        \Eqv X \eqdef \set{e \in \Rd(X) \mid e \text{ is an equivalence}},\quad \eqv X = \Eqv X \cap \cell X.
    \end{equation*}
\end{dfn}

\begin{prop} \label{prop:main_equivalence}
    Let \( X \) be a diagrammatic set.
    Then
    \begin{enumerate}
        \item every degenerate diagram is an equivalence;
        \item any two weak inverses of an equivalence are equivalent to each other;
    \end{enumerate}
    Furthermore, any morphism \( f \colon X \to Y \) of diagrammatic sets sends equivalences to equivalences.
\end{prop}
\begin{proof}
    See \cite[Theorem 2.13, Corollary 2.29, Proposition 2.31]{chanavat2024equivalences}.
\end{proof}

\subsection{Model structure for diagrammatic \texorpdfstring{$(\infty, n)$}{(∞, n)}-categories}


Recall that a \emph{marked diagrammatic set} is a diagrammatic set \( X \) together with a set \( A \subset \gr{> 0}{\cell X} \) called the \emph{marked cell}, containing all the degenerate cells. 
A morphism of marked diagrammatic sets is a morphism of the underlying diagrammatic sets sending marked cells to marked cells.
We write \( \mdgmSet \) for the category of marked diagrammatic sets and their morphisms. 
Furthermore, if \( P \) is a regular directed complex and \( A \subseteq \gr{> 0}{P} \) is a subset of elements of \( P \) of dimension \( > 0 \), we let \( (P, A) \) be the marked diagrammatic set \( (P, \dgn P \cup \set{\mapel{a} \mid a \in A}) \).

\begin{dfn}
    The functor \( \fun{U} \colon \mdgmSet \to \dgmSet \) forgetting the marking of a marked diagrammatic set has a left adjoint \( \minmark{(-)} \) defined by \( \minmark{X} \eqdef (X, \dgn X) \).
    Given a diagrammatic set, we also let \( \natmark{X} \eqdef (X, \eqv X) \).
    By Proposition \ref{prop:main_equivalence}, this is well defined and extends to a functor \( \natmark{(-)} \colon \dgmSet \to \mdgmSet \). 
\end{dfn}

\begin{dfn} [Marking]
   Let \( j \colon (X, A) \to (Y, B) \) be a morphism of marked diagrammatic sets. 
   We say that \( j \) is a \emph{marking} if \( \fun{U}j \) is an isomorphism.
\end{dfn}

\begin{dfn} \label{dfn:localisation}
    We recall the definition of \emph{localisation} from \cite[Section 2.4]{chanavat2024model}.
    A \emph{cellular extension} of a diagrammatic set \( X \) is a pushout diagram
    \begin{center}
        \begin{tikzcd}
            {\coprod_{e \in \cls{S}} \bd{}{}U_e} &&& {\coprod_{u \in \cls{S}} U_e} \\
            X &&& {X_\cls{S}}
            \arrow["{(\bd{}{}e)_{e \in \cls{S}}}", from=1-1, to=2-1]
            \arrow["{(e)_{e \in \cls{S}}}", from=1-4, to=2-4]
            \arrow[hook, from=2-1, to=2-4]
            \arrow["{\coprod_{e \in \cls{S}}\bd{U_e}{}}", hook, from=1-1, to=1-4]
            \arrow["\lrcorner"{anchor=center, pos=0.125, rotate=180}, draw=none, from=2-4, to=1-1]
        \end{tikzcd}
    \end{center}
    in \( \dgmSet \) such that for each \( e \in \cls{S} \), \( U_e \) is an atom.

    Let \( (X, A) \) be a marked diagrammatic set.
    We define \( \preloc{X}{A} \) to be the diagrammatic set obtain by, for each cell \( a \colon u \celto v \) in \( A \cap \nd X \),
    \begin{enumerate}
        \item attaching cells \( a^L, a^R  \colon v \celto u \), then
        \item attaching cells \( \hinv{L}(a) \colon a \cp{} a^L \celto \un(u) \) and \( \hinv{R} \colon \un(v) \celto a^R \cp{} a \).
    \end{enumerate} 
    Then, let \( \order{0}{X} \eqdef X \) and \( \order{0}{A} \eqdef A \).
    Inductively on \( n > 0 \), define
    \begin{equation*}
        \order{n}{X} \eqdef \preloc{\order{n - 1}{X}}{\order{n - 1}{A}}, \quad\quad \order{n}{A} \eqdef \set{\hinv{R}(a), \hinv{L}(a) \mid a \in \order{n - 1}{A}}.
    \end{equation*}
    We then have a sequence of inclusions
    \begin{equation*}
        \order{0}{X} \incl \order{1}{X} \incl \ldots \incl \order{n}{X} \incl \ldots,
    \end{equation*}
    whose transfinite composition is \( \loc{X}{A} \), the \emph{localisation of \( X \) at \( A \)}, which comes equipped with a canonical inclusion \( X \incl \loc{X}{A} \).
    We may describe the non-degenerate cells of \( \loc{X}{A} \) as being either in the image of \( \nd X \setminus A \), or of the form \( \hinv{\s}a, (\hinv{\s}a)^L \) or \( (\hinv{\s}a)^R \) for \( a \in (\nd X) \cap A \) and a string \( \s \in \set{L, R}^* \), defined by \( \hinv{\langle\rangle} a \eqdef a \), and inductively on \( \s \in \set{L, R}^* \),
    \begin{align*}
        \hinv{L\s}a \eqdef \hinv{L}(\hinv{\s}a) &\colon \hinv{\s}a \cp{} (\hinv{\s}a)^L \celto \un(\bd{}{-}\hinv{\s}a),\\
        \hinv{R\s}a \eqdef \hinv{R}(\hinv{\s}a) &\colon (\hinv{\s}a)^R \cp{} \hinv{\s}a \celto \un(\bd{}{+}\hinv{\s}a).
    \end{align*}
    Then, by induction, if \( a \colon U \to X \), then \( \hinv{\s}(a) \colon \hcyl{\s} U \to X \).
    
    Finally, the construction of the localisation can be extended to a colimit preserving functor
    \begin{equation*}
        \Loc \colon \mdgmSet \to \dgmSet.
    \end{equation*}
    By definition, each cell in \( A \) becomes invertible in \( \loc{X}{A} \).
\end{dfn}

\begin{comm} \label{comm:diff_of_localisation}
    This definition of localisation differs slightly from the one given in \cite[2.38]{chanavat2024model}. 
    In the latter, the attached cell \( \hinv{R} \) has type \( a^R \cp{} a \celto \un(v) \), whereas in this version, we define \( \hinv{R} \colon \un(v) \celto a^R \cp{} a \), which explain the apparition of a dual in Definition \ref{dfn:higher_invertor_shape}.
    We made this choice to match the construction of the coherent walking equivalence in (\ref{dfn:strict_walking_equivalence}), so that Lemma \ref{lem:swE_is_iso_to_molecin_loc_globe} holds.
    The reader can be assured that this difference of definition is inessential, and in the sequel, we will always point out which of results of \cite{chanavat2024model} would need a small adjustment to apply in our case. 
\end{comm}

\begin{dfn} [Walking equivalence]
    Let \( U \) be an atom.
    The \emph{walking equivalence of shape \( U \)} is the diagrammatic set \( \selfloc{U} \eqdef \Loc (U, \set{\top_U}) \).
    We also write \( V \simeq W \) for the walking equivalence of shape \( V \celto W \), and \( \rglobe{n} \) for \( \dglobe{n - 1} \simeq \dglobe{n - 1} \) for \( n \geq 1 \). 
\end{dfn}

\begin{dfn} [Weak composites]
    Let \( X \) be a diagrammatic set.
    We say that \( X \) has \emph{weak composites} if for each round diagram \( u \colon U \to X \), there exists a cell \( \compos{u} \colon \compos{U} \to X \) parallel to \( u \) such that \( u \simeq \compos{u} \).
    In that case, \( \compos{u} \) is called a weak composite of \( u \).
\end{dfn}

\begin{dfn} [\( (\infty, n) \)\nbd category]
    Let \( n \in \mathbb{N} \cup \set{\omega} \), and \( X \) be a diagrammatic set.
    We say that \( X \) is an \( (\infty, n) \)\nbd category if:
    \begin{enumerate}
        \item \( X \) has weak composites
        \item all cells of dimension \( > n \) are equivalences.
    \end{enumerate}
    
    A morphisms of diagrammatic sets is called a \emph{functor} when its domain and codomain are \( (\infty, n) \)\nbd categories. 
\end{dfn}

\begin{rmk}
    In the case \( n = \infty \), the second condition is void.
\end{rmk}

\begin{dfn}
    Let \( U \) be a round molecule.
    The \emph{walking weak composite of \( U \)} is the inclusion of diagrammatic sets
    \begin{equation*}
        c_U \colon U \incl U \simeq \compos{U}.
    \end{equation*}
    We let \( \Jcomp \) be the set of walking weak composites.
\end{dfn}

\begin{dfn}
    Let \( n \in \mathbb{N} \cup \set{\omega} \).
    We let \( \Jn{n} \eqdef \set{U \incl \selfloc{U} \mid U \text{ atom}, \dim U > n } \).
\end{dfn}

\begin{rmk} \label{rmk:infty_n_cat_iff_rlp_Jcomp_Jn}
    By a simple variation of \cite[Proposition 3.8, Proposition 3.9]{chanavat2024model} to account for Comment \ref{comm:diff_of_localisation}, a diagrammatic set \( X \) is an \( (\infty, n) \)\nbd category if and only if it has the right lifting property against \( \Jcomp \cup \Jn{n} \).
\end{rmk}

\begin{lem} \label{lem:isofib_left_right_lift}
    Let \( f \colon X \to Y \) be a functor of \( (\infty, \infty) \)\nbd categories with the right lifting property against \( \Jcomp \), \( u \) be a round diagram in \( X \) and \( v \) a cell in \( Y \).
    Then
    \begin{enumerate}
        \item for all equivalences \( h \colon f(u) \celto v \), there exists an equivalence \( z \colon u \celto v' \) such that \( f(z) = h \);
        \item for all equivalences \( h \colon v \celto f(u) \), there exists an equivalence \( z \colon v' \celto u \) such that \( f(z) = h \).  
    \end{enumerate}
\end{lem}
\begin{proof}
    The first part follows from by a small variation of the proof of \cite[Proposition 3.7]{chanavat2024model} to account for Comment \ref{comm:diff_of_localisation}.
    Let \( h \colon v \celto f(u) \) be an equivalence.
    Then \( h \) has a weak inverse \( h' \colon f(u) \celto v \), which is itself an equivalence.
    Thus \( h' = f(z') \) for equivalence \( z' \colon v' \celto u \).
    Then, \( z' \) is an equivalence, thus has a weak inverse \( z'' \colon u \celto v' \).
    Since morphisms of diagrammatic set preserves weak inverses, \( f(z'') \) is a weak inverse of \( h' \).
    By Proposition \ref{prop:main_equivalence}, there exists an equivalence \( k \colon f(z'') \celto h \), 
    By the first part of the proof, \( k = f(k') \) for some equivalence \( k' \colon z'' \celto z \).
    In particular, \( h = f(z) \), and \( z \simeq z'' \) is an equivalence.
\end{proof}

\begin{dfn} [Marked horn]
    Let \( (U, A) \) be a marked atom with \( k \eqdef \dim U - 1 \geq 0 \), \( \a \in \set{-, +} \) and \( x \in \maxel{\bd{}{\a} U} \).
    Call \( \Lambda^x_U \eqdef U \setminus \set{\top_U, x} \)
    We say that the inclusion of marked regular directed complexes
    \begin{equation*}
        \lambda^x_U \colon (\Lambda^x_U, \Lambda^x_U \cap A) \incl (U, A) 
    \end{equation*}
    is a \emph{marked horn of \( U \)} if there exists molecules \( (\order{i}{L}, \order{i}{R})_{i = 1}^k \) such that
    \begin{enumerate}
        \item \( \bd{}{\a} U = \order{k}{L} \cp{k - 1} (\ldots \cp{1} \order{1}{L} \cp{0} \clset{x} \cp{0} \order{1}{R} \cp{1} \ldots) \cp{k - 1} \order{k}{R} \);
        \item \( \dim \order{i}{L}, \dim \order{i}{R} \le i \) for each \( 1 \le i \le k \);
        \item \( \gr{i}{\order{i}{L}} \cup \gr{i}{\order{i}{R}} \subseteq A \);
        \item \( x \in A \) if and only if \( \faces{}{-\a} U \subseteq A \).
    \end{enumerate}
    We let \( \Jhorn \) be the set of marked horn.
\end{dfn}

\begin{comm}
    Let \( \lambda^x_U \colon (\Lambda^x_U, \Lambda^x_U \cap A) \to (U, A) \) be a marked horn, and \( W \) be an \( (\infty, \infty) \)\nbd category.
    Recall from \cite[Comment 3.13]{chanavat2024model} that a morphism \( s \colon \Lambda^x_U \to W \) classifying in \( W \) an equation \( \fun{E}x \qeq v \) in the indeterminate \( x \), where \( v \eqdef \restr{s}{\bd{}{+}U} \), and \( \fun{E} \) is a context in the sense of \cite[3.1]{chanavat2024equivalences}.
    Now if \( s \) defines furthermore a morphisms of marked diagrammatic sets \( s \colon (\Lambda^x_U, \Lambda^x_U \cap A) \to \natmark{W} \), then this implies that the context \( \fun{E} \) is weakly invertible.
    By \cite[Lemma 5.10]{chanavat2024equivalences}, this equation has a solution \( u \), witnessed by an equivalence \( h \colon \fun{E}u \celto v \), which is exactly the data of an extension of \( s \) along \( \lambda^x_U \).
\end{comm}

\begin{lem} \label{lem:isofib_rlp_marked_horn}
    Let \( f \colon X \to Y \) be a functor of \( (\infty, \infty) \) category with the right lifting property against \( \Jcomp \),
    Then \( \natmark{f} \) has the right lifting property against \( \Jhorn \).
\end{lem}
\begin{proof}
    Let \( \lambda^x_U \colon (\Lambda^x_U, \Lambda^x_U \cap A) \to (U, A) \) be a marked horn, assume without loss of generality that \( x \in \bd{}{-} U \), and consider a lifting problem
    \begin{center}
        \begin{tikzcd}
            {(\Lambda^x_U, \Lambda^x_U \cap A)} & \natmark{X} \\
            {(U, A)} & {\natmark{Y}.}
            \arrow["s", from=1-1, to=1-2]
            \arrow[from=1-1, to=2-1]
            \arrow["\natmark{f}", from=1-2, to=2-2]
            \arrow["h"', from=2-1, to=2-2]
        \end{tikzcd}
    \end{center}
    By \cite[Theorem 4.9]{chanavat2024model}, both \( \natmark{X} \) and \( \natmark{Y} \) have the right lifting property against \( \Jhorn \).
    Then \( s \) classifies in \( X \) an equation \( \fun{E}x \qeq v \) in the unknown \( x \), where \( \fun{E} \) is a weakly invertible context. 
    Let us choose a solution \( u \) witnessed by an equivalence \( z \colon \fun{E}u \celto v \).
    Moreover, by assumption, \( h \colon (f\fun{E})w \celto f(v) \) is an equivalence in \( Y \).
    In \( Y \), we may form the equation 
    \begin{equation*}
        y \cpsub{f(u)} f(z) \qeq h,
    \end{equation*}
    in the unknown \( y \), which has a solution \( e \colon w \celto f(u) \) witnessed by an equivalence \( k \colon e \cpsub{} f(z) \celto h \).
    By Lemma \ref{lem:isofib_left_right_lift}, \( e = f(e') \) for some equivalence \( e' \colon w' \celto u \).
    Thus \( k \) has type \( f(e' \cpsub{} z) \celto h \).
    By Lemma \ref{lem:isofib_left_right_lift} again, \( k = f(k') \) for some equivalence \( k' \colon e' \cpsub{} z \celto h' \).
    In particular, \( h' \) is an equivalence of type \( \fun{E}w' \celto v \) and \( f(h') = h \).
    If \( \faces{}{+} U \subseteq A \), then \( v \) is an equivalence, hence by \cite[Theorem 5.22]{chanavat2024equivalences}, \( w' \) is an equivalence.
    This shows that \( h' \colon U \to X \) extends to a morphism \( (U, A) \to \natmark{X} \) solving the lifting problem.
    This concludes the proof.
\end{proof}

\begin{prop} \label{prop:model_structre_on_marked_dgm_set}
    For each \( n \in \mathbb{N} \cup \set{\omega} \) exists a model structure on diagrammatic sets, called the \emph{coinductive \( (\infty, n) \)\nbd model structure}, where
    \begin{enumerate}
        \item cofibrations are the monomorphisms;
        \item fibrant objects are of the form \( \natmark{X} \) for \( X \) an \( (\infty, n) \)\nbd category.
    \end{enumerate}
\end{prop}
\begin{proof}
    See \cite[3.24, Theorem 4.9]{chanavat2024model}.
\end{proof}

\begin{lem} \label{lem:marked_localisation_acyclic}
    Let \( n \in \mathbb{N} \cup \set{\omega} \) and \( U \) be an atom of dimension \( \geq 1 \).
    Then the marking \( \minmark{\selfloc{U}} \incl (\selfloc{U}, \dgn \selfloc{U} \cup \set{\iota \colon U \incl \selfloc{U}}) \) is an acyclic cofibration in the coinductive \( (\infty, n) \)\nbd model structure.
\end{lem}
\begin{proof}
    A marking is an acyclic cofibration if and only if it has the left lifting property against all fibrant object.
    Let \( X \) be an \( (\infty, n) \)\nbd category and consider a morphism \( u \colon \minmark{\selfloc{U}} \to \natmark{X} \).
    By construction, \( u \after \iota \colon U \to X \) is an equivalence in \( X \), thus is marked in \( \natmark{X} \).
    This shows that the lifting problem has a solution and concludes the proof.
\end{proof}

\noindent Recall that in a model structure, a \emph{pseudo-generating set of acyclic cofibrations} is a set of \( J \) of acyclic cofibration such that a morphism with fibrant codomain is a fibration if and only if it has the right lifting property against \( J \).

\begin{thm} \label{thm:n_model_structure_on_dgm_set}
    Let \( n \in \mathbb{N} \cup \set{\omega} \).
    Then there exists a model structure on diagrammatic sets, called the \emph{\( (\infty, n) \)\nbd model structure}, such that
    \begin{enumerate}
        \item the set \( \set{\bd{}{} U \incl U \mid U \text{ atom}} \) is a generating set of cofibrations;
        \item fibrant objects are the \( (\infty, n) \)\nbd categories;
        \item \( \Jcomp \cup \Jn{n} \) is a pseudo-generating set of acyclic cofibrations.
    \end{enumerate}
    Furthermore, the adjunction \( \minmark{(-)} \dashv \fun{U} \) is a Quillen equivalence with the coinductive \( (\infty, n) \)\nbd model structure on marked diagrammatic sets.
\end{thm}
\begin{proof}
    The existence as well as the characterisation of fibrant objects, and the Quillen equivalence are given by \cite[3.27, Theorem 4.21, Theorem 4.23]{chanavat2024model}.
    % In particular, the fibrant objects of the coinductive \( (\infty, n) \)\nbd model are of the form \( \natmark{X} \) for \( X \) an \( (\infty, n) \)\nbd category.
    Using a slight variation of \cite[Lemma 4.16, Lemma 4.17]{chanavat2024model} to account for Comment \ref{comm:diff_of_localisation} together with Lemma \ref{lem:marked_localisation_acyclic}, one sees that the set \( \minmark{(\Jcomp \cup \Jn{n})} \) is a set of acyclic cofibrations.
    By Remark \ref{rmk:infty_n_cat_iff_rlp_Jcomp_Jn}, \( \Jcomp \cup \Jn{n} \) detects fibrant objects.
    Since left Quillen equivalences reflect weak equivalences between cofibrant objects, \( \Jcomp \cup \Jn{n} \) is a set of acyclic cofibration.
    Let \( f \colon X \to Y \) be a functor of \( (\infty, n) \)\nbd category with the right lifting property against \( \Jcomp \cup \Jn{n} \).
    We need to prove that \( f \) is a fibration.
    Since \( \fun{U}\natmark{f} = f \), is it enough to prove that \( \natmark{f} \) is a fibration. 
    By Lemma \ref{lem:isofib_rlp_marked_horn}, \( \natmark{f} \) has the right lifting property against \( \Jhorn \).
    By \cite[Theorem 4.22]{chanavat2025gray}, a set of pseudo-generating acyclic cofibration for the coinductive \( (\infty, n) \)\nbd model structure is given by \( \Jhorn \cup J_{\mathsf{mark}} \), where \( J_{\mathsf{mark}} \) is a set of markings.
    But a morphism of marked diagrammatic sets has the right lifting property against a collection of markings \( J \) if and only if its domain has the right lifting property against \( J \).
    Since the domain of \( \natmark{f} \) is the fibrant object \( \natmark{X} \), we conclude.
\end{proof}

\begin{comm}
    In \cite{chanavat2024model}, a pseudo generating set of acyclic cofibrations for the \( (\infty, n) \)\nbd model structure was given by a closure \( \mathrm{an}(\Jcomp \cup \Jn{n}) \) of \( \Jcomp \cup \Jn{n} \) under certain Gray products.
    We showed in Theorem \ref{thm:n_model_structure_on_dgm_set} that this closure is unnecessary.
\end{comm}

